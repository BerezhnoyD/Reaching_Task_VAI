<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li:not(:nth-child(4)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(4) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(4) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Software part | ReachOut kinematic analysis</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Software part" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="This is a description of ReachOut software" /> <meta property="og:description" content="This is a description of ReachOut software" /> <link rel="canonical" href="http://localhost:4000/software.html" /> <meta property="og:url" content="http://localhost:4000/software.html" /> <meta property="og:site_name" content="ReachOut kinematic analysis" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Software part" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"This is a description of ReachOut software","headline":"Software part","url":"http://localhost:4000/software.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> ReachOut kinematic analysis </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/assembly.html" class="nav-list-link">Behavioral apparatus</a></li><li class="nav-list-item"><a href="/hardware.html" class="nav-list-link">Hardware part</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Software part category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/software.html" class="nav-list-link">Software part</a><ul class="nav-list"><li class="nav-list-item"><a href="/install.html" class="nav-list-link">Software Installation</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search ReachOut kinematic analysis" aria-label="Search ReachOut kinematic analysis" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 id="triangulation-and-analysis-of-behavioral-videos"> <a href="#triangulation-and-analysis-of-behavioral-videos" class="anchor-heading" aria-labelledby="triangulation-and-analysis-of-behavioral-videos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Triangulation and analysis of behavioral videos </h1> <p><img src="/images/reconstruction.PNG" alt="drawing" width="400" height="400" /></p> <p>In addition to the hardware part, we provide the complementary software data analysis pipeline which can be performed off-line with the acquired videos. Python package for the 3d trajectory reconstruction and kinematic analysis is organized in classes and modules implemented in a series of Jupyter Notebooks and based on the state-of-the-art solutions for the markerless pose estimation as well as original code</p> <ul> <li><a href="https://github.com/DeepLabCut/DeepLabCut">DeepLabCut</a> is used for intial tracking using pretrained ResNet architecture (&amp; training it).</li> <li><a href="https://github.com/lambdaloop/anipose">Anipose Lib</a> is used for the 3d triangulation part to restore the action in absolute coordinates (mm).</li> <li><a href="https://github.com/BerezhnoyD/Reaching_Task_VAI/">ReachOut</a> is our humble code contribution and is used for all the analysis on kinematic traces.</li> </ul><hr /> <h2 id="reachout-kinematic-analysis-pipeline"> <a href="#reachout-kinematic-analysis-pipeline" class="anchor-heading" aria-labelledby="reachout-kinematic-analysis-pipeline"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ReachOut kinematic analysis pipeline </h2> <p>The <a href="https://github.com/BerezhnoyD/Reaching_Task_VAI/">ReachOut</a> pipeline can be used separately on your own videos and guides the user through the number of steps to extract the parts from the video, track and triangulate the points of interest (paw, fingers), cluster the reaches, visualize and compare basic kinematic parameters for different reaching categories. User has the ability to export the final data on the kinematics (scalars for each reach) and reaching timestamps as a *.h5/.csv table for further analysis or synchronization with his own pipeline.</p> <p><img src="/images/Slide3.png" alt="alt text" /></p> <p>Analysis pipeline consists of extracting the parts from the video, tracking and triangulating the points of interest (paw, fingers), clustering the reaches, visualizing and comparing basic kinematic parameters between different reaching categories. We suggest copying the whole folder</p> <ul> <li><strong>2D pipeline</strong> or</li> <li><strong>3D pipeline</strong></li> </ul> <p>from the <a href="https://github.com/BerezhnoyD/Reaching_Task_VAI/tree/main/Analysis%20toolbox">Analysis Toolbox</a>, nd then running the Notebooks using <strong>Jupyter</strong></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="n">cd</span> <span class="n">path</span>\<span class="n">to</span>\<span class="n">the</span> <span class="n">scripts</span>\
<span class="o">&gt;</span> <span class="n">conda</span> <span class="n">activate</span> <span class="n">DEEPLABCUT</span>
<span class="o">&gt;</span> <span class="n">jupyter</span> <span class="n">notebook</span>
</code></pre></div></div><hr /> <h2 id="using-reachout-analysis-pipeline"> <a href="#using-reachout-analysis-pipeline" class="anchor-heading" aria-labelledby="using-reachout-analysis-pipeline"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using ReachOut analysis pipeline </h2> <p class="note">There are two pipelines provided - one for 3d analysis and reconstruction, and a simpler 2d one, working with only one video (single camera view). We mention the differences in the following sections and suggest to start with a simpler one if your experiment doesn’t specfically require triangulation and representation of coordinates in absolute space (in <em>mm</em>).</p> <p>The Notebooks are split by their function: <strong>ReachOut - Tracking</strong> guides the user throught the necessary steps for tracking the points of interest</p> <ul> <li>Cutting the video acquired with FLIR camera into three parts - <em>specific for our setup with two mirrors</em></li> <li>Opening the DeepLabCut interface window and running through the full pipeline to track the points of interest</li> <li>Updating the csv output from DeepLabCut with absolute position for our reference points</li> <li>Using the code from Anipose lib and preprecorded calibration videos to triangulate the points - <em>specific for our setup with two mirrors</em></li> </ul> <p><img src="/images/Slide4.png" alt="alt text" /></p> <p><strong><em>Here are the main steps as described in the Notebooks</em></strong></p><hr /> <h3 id="reachout---tracking"> <a href="#reachout---tracking" class="anchor-heading" aria-labelledby="reachout---tracking"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ReachOut - Tracking </h3> <p>**Provides all the scripts to process the behavioral videos and get to the .csv file with **</p> <p><img src="/images/Notebook1.PNG" alt="alt text" /></p> <ol> <li>Cut the video from the FLIR camera into three parts - three different views of the reach <blockquote> <p>We are recording the videos of the reaching task using the single high speed widefield FLIR camera and multiple mirrors. So the first part is to cut single video into parts corresponding to the Rightside view (CamA), Center view (CamB), Leftside view (CamC) with respect to the animal paw. This eliminates the need for synchronisation of different videos, but adds this additional step before we can analyze our videos with DLC. As a result of this step you should get three video files with the names -camA, -camB, -camC</p> </blockquote> </li> <li>Analyze the video with DeepLabCut <blockquote> <p>This step is performed using open-source <a href="https://github.com/DeepLabCut/DeepLabCut">DeepLabCut</a> package, the tutorial and more info on which can be found on GitHub. In short, the first command should launch DeepLabCut interface which guides you through creating the network, training dataset from your videos (selecting subset of frames and manually labeling the points of interest), training &amp; evaluating the network and finally applying it to all your videos. The final output should be a <em>.csv</em> file for each video with coordinates (in pixel dimensions) for all the points tracked by the network. We added some code to open, check this table and insert necessary columns with static points for triangulation.</p> </blockquote> </li> </ol> <p class="warning">It should be further noted that despite the Anipose documentation advice to use single DLC network for all views we found that better results are achieved with two separate networks trained on the side(1) and front(2) view. That means we start DLC analysis for our videos twice - first time for all the CamA/C videos, and the second time for CamB. As a result we get two separate sets of <em>*.csv *.h5</em> files. For the next step they should have the same name with the difference of last prefix “A,B,C” and copied together to one folder accessible by this Notebook. <strong><em>Not needed if using simpler 2D pipeline without triangulation</em></strong></p> <ol> <li>Triangulate the 2d trajectories with Anipose and check the quality of the 3d trajectory <blockquote> <p>This step is done using the open-source Anipose package, so the tutorial and more info on them can be found on GitHub Here we provide the code snippet (from <a href="https://github.com/lambdaloop/anipose">Anipose Lib</a>) to calibrate the camera intrinsics using prerecorded videos or checkerboard pattern and use the resulting <em>calibration.toml</em> file to triangulate coordinates for the paw in absolute space.</p> <p>If you want to use Anipose interface for triangulation you should manually put the resulting .csv and .h5 files into anipose project folder <em>*/Anipose project/pose-2d before</em> before starting the triangulation command <em>anipose triangulate</em></p> <p>As a result of this step you should get the single <em>*.csv</em> file for each session, containing absolute x,y,z coordinates, that we will use further<br /> <strong><em>Not needed if using simpler 2D pipeline without triangulation</em></strong></p> </blockquote> </li> </ol><hr /> <h3 id="reachout---analysis"> <a href="#reachout---analysis" class="anchor-heading" aria-labelledby="reachout---analysis"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ReachOut - Analysis </h3> <p><strong>Provides multiple gui snippets to manually segment and annotate the results from DeepLabCut</strong></p> <p><img src="/images/Notebook2.PNG" alt="alt text" /></p> <ul> <li>Manually scroll through DeepLabCut tracking coordinates, plot them and choose the segments for kinematic analysis (<em>reaches in our case</em>)</li> <li>Load the selected parts of the trajectory and manually annotate them from watching the corresponding parts of the video (<em>we defined different reaching categories</em>)</li> </ul> <ol> <li>Open the <em>.csv</em> file, scroll through the trajectories and manually choose the fragments of the trajectory (<em>with the reaches</em>) for analysis <blockquote> <p>This script will ask you to choose a file with the OpenFile interface. Point it to the *.csv file generated by the previous notebook. It will open the GUI to review the 2d trajectory with time used as a 3rd dimension and extract the fragments of the trajectory for further analysis. As a result of this step you will have the *.h5 file with the fragments of the trajectory that you’ve chosen. Open this file to review the trajectories.</p> </blockquote> </li> </ol> <p>Small video showing the workflow</p> <iframe width="960" height="520" src="/images/Step3.mp4" frameborder="0" allowfullscreen=""></iframe> <p class="note">In cotrast to the standard 3D pipeline (tracking_split), 2D relies on the different script (tracking_split_2d), all other steps are the same, but with the time substituting Z-dimension in the 3D plot, that way you basically see the change in 2d trajectory with time.</p> <ol> <li>Open the h5 file and the corresponding video to review and classify the trajectories <blockquote> <p>This script is made to load the selected parts of the trajectory and manually annotate them from watching the corresponding parts of the video. For this script to work point it to the <em>*.h5</em> file you want to analyze (file) and the video corresponding to the same session (file2.mp4) and then use the GUI to rewatch the video fragments and manually assign the labels. As a result of this step you will have the <em>*scalars.h5</em> file which is used in the vizualisation steps 5 and 6.</p> </blockquote> </li> </ol> <iframe width="960" height="520" src="/images/Step4.mp4" frameborder="0" allowfullscreen=""></iframe><hr /> <h3 id="reachout---visualization"> <a href="#reachout---visualization" class="anchor-heading" aria-labelledby="reachout---visualization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ReachOut - Visualization </h3> <p><strong>Provides the user with multiple ways to visualize the data and kinematic parameters</strong></p> <p><img src="/images/Notebook3.PNG" alt="alt text" /></p> <ul> <li>Look at superimposed trajectories for the chosen category of action - <em>reaches in our case</em></li> <li>Look at the violin plots for different kinematic parameters for the chosen category of action</li> <li>Cluster the actions based on the chosen set of parameters</li> </ul> <ol> <li>Open the scalars.h5 file and plot all the trajectories of the chosen category <blockquote> <p>This snippet shows all reaches in the chosen category as Timeseries for visual inspection and analysis. From the lists you can choose the category of reaches and the type of data to plot.</p> </blockquote> </li> </ol> <p><img src="/images/Trajectories.PNG" alt="alt text" /></p> <ol> <li>Open the scalars.h5 file and make violin plots for the chosen parameters and reach categories</li> </ol> <p><img src="/images/Scalars.PNG" alt="alt text" /></p> <ol> <li> <p>Open the scalars.h5 file and automatically cluster the reaches using one of the built in methods</p> </li> <li> <p>Show the number of reaches in each category</p> </li> </ol><hr /> <h2 id="qa"> <a href="#qa" class="anchor-heading" aria-labelledby="qa"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Q&amp;A </h2> <p>If you still have questions after reading this and <a href="https://star-protocols.cell.com/protocols/3539">STAR Protocols</a> please let us know and we list it in this section.</p><hr /> <hr> <h2 class="text-delta">Table of contents</h2> <ul> <li> <a href="/install.html">Software Installation</a> </li> </ul> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
